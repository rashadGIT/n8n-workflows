{
  "id": "p4rVxlsnMODu78Km",
  "name": "MST Email Automation",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "2570b966-3b9d-4dd6-981d-53cf2a79e2aa",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "name": "Webhook",
      "webhookId": "2570b966-3b9d-4dd6-981d-53cf2a79e2aa"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"sent\": {{ $json.success }}\n}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        928,
        0
      ],
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "body",
              "value": "={{ $json.body}}"
            }
          ]
        },
        "options": {
          "dotNotation": true
        }
      },
      "name": "Get Customer Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        224,
        0
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=## Overview\nYou are a seasoned industry research analyst with extensive expertise in interpreting customer data, identifying industry classifications, and producing advanced market and competitive intelligence. Your task is to analyze the provided JSON input and deliver a fully structured industry report aligned with the required output schema.\n\nYour analysis should emphasize accuracy, clarity, depth, and business relevance. Ensure your reasoning is data-driven and your insights reflect real market conditions.\n\n## Tools\nYou have access to:\n- Your internal knowledge base of industry classifications, market structures, competitor landscapes, regulatory environments, and global trends.\n- Advanced analytical reasoning to parse customer data and infer the most appropriate industry sector and sub-sector.\n\n## Rules\nFollow these rules without exception:\n\n1. **Industry Identification**\n   - Parse and interpret the provided input JSON.\n   - Extract any relevant descriptors that indicate the customer's industry.\n   - Identify the exact sector and, if possible, sub-sector.\n   - Provide a confidence score (0 to 1) and a short rationale.\n\n2. **Industry Deep Dive**\n   - Describe the current state of the identified industry.\n   - Highlight market size, key segments, leading players, growth drivers, obstacles, and opportunities.\n\n3. **Competitive Landscape**\n   - Identify major competitors.\n   - Explain each competitor’s position, strengths, weaknesses, and any notable strategic initiatives.\n\n4. **Trend Analysis**\n   - Outline major technological, regulatory, economic, and consumer-behavior trends impacting the industry.\n   - Include expected impacts and time horizons when applicable.\n\n5. **Strategic Insights**\n   - Provide actionable, high-value recommendations the customer can use.\n   - Assign each recommendation a priority and explain the rationale and expected impact.\n\n6. **Output Requirements**\n   - Your final answer must strictly match the JSON schema provided.\n   - Do not include commentary, explanations, or markdown.\n\n## Instructions\nAnalyze the customer’s input data and complete the full industry analysis using the structure defined in the schema.\n\nHere is the provided input JSON to analyze:  \n**{{ $('Get Customer Data').item.json.body.toJsonString() }}**\n\nBase all insights solely on the industry inferred from this data.\n\nEnsure every field in the JSON output is:\n- Fact-based  \n- Thorough  \n- Professionally written  \n- Useful for decision-making  \n\n## Final Reminder\n- The current date is: **{{ $now.format(\"DD\") }}**",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1200,
        0
      ],
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1-2025-11-13",
          "mode": "list",
          "cachedResultName": "gpt-5.1-2025-11-13"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1088,
        192
      ],
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "da8hD2Yc3TlZwFUC",
          "name": "MST Open AI"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"title\": \"IndustryAnalysisOutput\",\n  \"type\": \"object\",\n  \"description\": \"Structured response for industry and competitive analysis based on customer data.\",\n  \"properties\": {\n    \"identifiedIndustry\": {\n      \"type\": \"string\",\n      \"description\": \"The primary industry sector identified for the customer.\"\n    },\n    \"industryIdentification\": {\n      \"type\": \"object\",\n      \"description\": \"Details on how the industry was identified from the customer data.\",\n      \"properties\": {\n        \"sector\": { \"type\": \"string\" },\n        \"subSector\": { \"type\": \"string\" },\n        \"confidenceLevel\": {\n          \"type\": \"number\",\n          \"description\": \"Confidence score between 0 and 1.\",\n          \"minimum\": 0,\n          \"maximum\": 1\n        },\n        \"rationale\": {\n          \"type\": \"string\",\n          \"description\": \"Explanation of how the industry classification was derived from the input data.\"\n        }\n      },\n      \"required\": [\"sector\", \"confidenceLevel\", \"rationale\"]\n    },\n    \"industryDeepDive\": {\n      \"type\": \"object\",\n      \"description\": \"Comprehensive overview of the identified industry.\",\n      \"properties\": {\n        \"overview\": { \"type\": \"string\" },\n        \"marketSizeAndGrowth\": { \"type\": \"string\" },\n        \"keySegments\": { \"type\": \"string\" },\n        \"keyPlayers\": { \"type\": \"string\" },\n        \"growthDrivers\": { \"type\": \"string\" },\n        \"challengesAndRisks\": { \"type\": \"string\" },\n        \"opportunities\": { \"type\": \"string\" }\n      },\n      \"required\": [\"overview\"]\n    },\n    \"competitiveLandscape\": {\n      \"type\": \"array\",\n      \"description\": \"List of key competitors in the identified industry.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"name\": { \"type\": \"string\" },\n          \"description\": { \"type\": \"string\" },\n          \"marketPositioning\": { \"type\": \"string\" },\n          \"strengths\": { \"type\": \"string\" },\n          \"weaknesses\": { \"type\": \"string\" },\n          \"strategicInitiatives\": {\n            \"type\": \"string\",\n            \"description\": \"Notable strategies, moves or investments (e.g., M&A, new products, geographic expansion).\"\n          }\n        },\n        \"required\": [\"name\", \"marketPositioning\"]\n      }\n    },\n    \"trendAnalysis\": {\n      \"type\": \"object\",\n      \"description\": \"Key trends impacting the industry.\",\n      \"properties\": {\n        \"technological\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"trend\": { \"type\": \"string\" },\n              \"impact\": { \"type\": \"string\" },\n              \"timeHorizon\": { \"type\": \"string\" }\n            },\n            \"required\": [\"trend\", \"impact\"]\n          }\n        },\n        \"regulatory\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"trend\": { \"type\": \"string\" },\n              \"impact\": { \"type\": \"string\" }\n            },\n            \"required\": [\"trend\", \"impact\"]\n          }\n        },\n        \"economic\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"trend\": { \"type\": \"string\" },\n              \"impact\": { \"type\": \"string\" }\n            },\n            \"required\": [\"trend\", \"impact\"]\n          }\n        },\n        \"consumerBehavior\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"trend\": { \"type\": \"string\" },\n              \"impact\": { \"type\": \"string\" }\n            },\n            \"required\": [\"trend\", \"impact\"]\n          }\n        }\n      }\n    },\n    \"strategicInsights\": {\n      \"type\": \"array\",\n      \"description\": \"Actionable recommendations for the customer.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"recommendation\": {\n            \"type\": \"string\",\n            \"description\": \"What the customer should do.\"\n          },\n          \"rationale\": {\n            \"type\": \"string\",\n            \"description\": \"Why this recommendation matters in the current industry context.\"\n          },\n          \"expectedImpact\": {\n            \"type\": \"string\",\n            \"description\": \"Expected business impact (e.g., revenue, risk mitigation, market share).\"\n          },\n          \"priority\": {\n            \"type\": \"string\",\n            \"enum\": [\"low\", \"medium\", \"high\", \"critical\"],\n            \"description\": \"Priority level for execution.\"\n          },\n          \"timeHorizon\": {\n            \"type\": \"string\",\n            \"description\": \"Suggested time horizon, e.g., short-term, mid-term, long-term.\"\n          }\n        },\n        \"required\": [\"recommendation\", \"rationale\", \"priority\"]\n      }\n    }\n  },\n  \"required\": [\"identifiedIndustry\", \"industryIdentification\", \"industryDeepDive\", \"strategicInsights\"],\n  \"additionalProperties\": false\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1408,
        208
      ],
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Get Customer Data').item.json.body.primary_email }}",
        "subject": "Thank You for Completing Your Client Information Form",
        "message": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>MST – Thank You</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      background: #f3f4ff;\n      font-family: Arial, Helvetica, sans-serif;\n      color: #333333;\n    }\n    .email-wrapper {\n      width: 100%;\n      padding: 20px 0;\n    }\n    .email-container {\n      max-width: 640px;\n      margin: 0 auto;\n      background: #ffffff;\n      border-radius: 12px;\n      padding: 24px 28px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n      border-top: 6px solid #4f46e5;\n    }\n    .email-header {\n      text-align: center;\n      margin-bottom: 18px;\n    }\n    .email-header h1 {\n      margin: 0;\n      font-size: 24px;\n      color: #4f46e5;\n    }\n    .email-badge {\n      display: inline-block;\n      margin-top: 8px;\n      padding: 4px 10px;\n      border-radius: 999px;\n      background: #eef2ff;\n      color: #4338ca;\n      font-size: 12px;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      font-weight: 600;\n    }\n    .email-body p {\n      line-height: 1.6;\n      font-size: 15px;\n      margin: 10px 0;\n    }\n    .email-body strong {\n      color: #1d4ed8;\n    }\n    .highlight-box {\n      margin: 18px 0;\n      padding: 14px 16px;\n      border-radius: 10px;\n      background: #ecfeff;\n      border: 1px solid #a5f3fc;\n      font-size: 14px;\n      color: #0f172a;\n    }\n    .cta-button {\n      display: inline-block;\n      margin-top: 18px;\n      padding: 10px 20px;\n      border-radius: 999px;\n      background: #4f46e5;\n      color: #ffffff !important;\n      text-decoration: none;\n      font-size: 14px;\n      font-weight: 600;\n    }\n    .cta-button:hover {\n      background: #4338ca;\n    }\n    .email-footer {\n      text-align: center;\n      margin-top: 22px;\n      font-size: 12px;\n      color: #6b7280;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"email-wrapper\">\n    <div class=\"email-container\">\n      <div class=\"email-header\">\n        <h1>Welcome to MST</h1>\n        <div class=\"email-badge\">New Client</div>\n      </div>\n\n      <div class=\"email-body\">\n        <p>Dear {{ $('Get Customer Data').item.json.body.client_name }},</p>\n\n        <p>\n          Thank you for taking the time to complete the\n          <strong>MST Client Information Document</strong>.\n          We truly appreciate you providing these important details.\n        </p>\n\n        <div class=\"highlight-box\">\n          Our team is now reviewing your information. Once the review is complete,\n          we’ll reach out with any follow-up questions and to walk you through the next steps.\n        </div>\n\n        <p>\n          We’re excited to welcome you to <strong>MST</strong> and look forward to supporting your needs.\n          Our goal is to make things as smooth and stress-free as possible for you.\n        </p>\n\n        <p>\n          If you have any questions in the meantime, please feel free to contact us.\n          We’re here to ensure a seamless experience every step of the way.\n        </p>\n\n        <p>\n          Thank you again for choosing MST — we look forward to working with you.\n        </p>\n\n        <p>\n          Warm regards,<br />\n          <strong>MST Team</strong>\n        </p>\n\n        <!-- Optional CTA (you can remove this if you don’t want a button) -->\n        <!--\n        <a href=\"#\" class=\"cta-button\">Visit Our Website</a>\n        -->\n      </div>\n\n      <div class=\"email-footer\">\n        © {{ new Date().getFullYear() }} MST. All rights reserved.\n      </div>\n    </div>\n  </div>\n</body>\n</html>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        736,
        -256
      ],
      "name": "Send Email to Customer",
      "webhookId": "79ea3ea2-f50a-4caa-bb06-403d9940d63f",
      "credentials": {
        "gmailOAuth2": {
          "id": "BTKh5C4ujrbOxvPI",
          "name": "Rashad.barnett@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "rashadbarnett@gmail.com, michelle.turner@mstcpatx.com",
        "subject": "=MST | Client Intake Summary – {{ $json.body.client_name }}",
        "message": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Client Information Summary</title>\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      background-color: #f5f5f7;\n      margin: 0;\n      padding: 20px;\n      color: #333;\n    }\n    .container {\n      max-width: 900px;\n      margin: 0 auto;\n      background: #ffffff;\n      padding: 20px 30px;\n      border-radius: 8px;\n      box-shadow: 0 2px 6px rgba(0,0,0,0.08);\n    }\n    h1, h2 {\n      margin-top: 0;\n      color: #222;\n    }\n    h1 {\n      font-size: 22px;\n      border-bottom: 2px solid #eee;\n      padding-bottom: 10px;\n      margin-bottom: 20px;\n    }\n    h2 {\n      font-size: 18px;\n      margin-top: 25px;\n      border-left: 4px solid #4a90e2;\n      padding-left: 8px;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 10px 30px;\n    }\n    .field {\n      margin-bottom: 6px;\n    }\n    .label {\n      font-weight: bold;\n      display: inline-block;\n      min-width: 160px;\n    }\n    .value {\n      display: inline-block;\n    }\n    .full-width {\n      grid-column: 1 / -1;\n    }\n    .tag-list {\n      margin: 4px 0 0 0;\n      padding-left: 18px;\n    }\n    .tag-list li {\n      margin-bottom: 4px;\n    }\n    .note {\n      font-size: 12px;\n      color: #777;\n      margin-top: 10px;\n    }\n    @media (max-width: 600px) {\n      .grid {\n        grid-template-columns: 1fr;\n      }\n      .label {\n        min-width: 120px;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <h1>Client Information Summary</h1>\n\n    <!-- Client Overview -->\n    <h2>Client Overview</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Client Name:</span>\n        <span class=\"value\">{{ $json.body.client_name || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Client Short Name:</span>\n        <span class=\"value\">{{ $json.body.client_short_name || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Address:</span>\n        <span class=\"value\">{{ $json.body.client_address || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Industry:</span>\n        <span class=\"value\">{{ $json.body.industry || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Softwares Used:</span>\n        <span class=\"value\">{{ $json.body.softwares_used || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Business Operations Summary:</span>\n        <span class=\"value\">{{ $json.body.business_ops_summary || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Contacts -->\n    <h2>Primary Contact</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Name &amp; Title:</span>\n        <span class=\"value\">{{ $json.body.primary_name_title || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Phone:</span>\n        <span class=\"value\">{{ $json.body.primary_phone || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Email:</span>\n        <span class=\"value\">{{ $json.body.primary_email || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Contact For:</span>\n        <span class=\"value\">\n          {{ $json.body.primary_contact_for || \"N/A\" }}\n          {{ $json.body.primary_contact_other ? \" (\" + $json.primary_contact_other + \")\" : \"\" }}\n        </span>\n      </div>\n    </div>\n\n    <h2>Other Contact</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Name:</span>\n        <span class=\"value\">{{ $json.body.other_name || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Phone:</span>\n        <span class=\"value\">{{ $json.body.other_phone || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Email:</span>\n        <span class=\"value\">{{ $json.body.other_email || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Contact For:</span>\n        <span class=\"value\">{{ $json.body.other_contact_for || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Associated Entities -->\n    <h2>Associated Entities</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Entity 1:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_1 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Entity 2:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_2 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Entity 3:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_3 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Entity 4:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_4 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Entity 5:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_5 || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Services & Needs -->\n    <h2>Services &amp; Needs</h2>\n    <div class=\"grid\">\n      <div class=\"field full-width\">\n        <span class=\"label\">Client Services (Notes):</span>\n        <span class=\"value\">\n          {{\n            [\n              $json.body.client_services_1,\n              $json.body.client_services_2,\n              $json.body.client_services_3,\n              $json.body.client_services_4,\n              $json.body.client_services_5,\n              $json.body.client_services_6\n            ].filter(s => s).join(\"; \")\n            || \"N/A\"\n          }}\n        </span>\n      </div>\n\n      <div class=\"field full-width\">\n        <span class=\"label\">Service Needs:</span>\n        <ul class=\"tag-list\">\n          <li>Accounting: {{ $json.body.needs_accounting ? \"Yes\" : \"No\" }}</li>\n          <li>Payroll: {{ $json.body.needs_payroll ? \"Yes\" : \"No\" }} \n            {{ $json.body.needs_payroll_states ? \"(States: \" + $json.needs_payroll_states + \")\" : \"\" }}\n          </li>\n          <li>Sales Tax: {{ $json.body.needs_sales_tax ? \"Yes\" : \"No\" }} \n            {{ $json.body.needs_sales_tax_states ? \"(States: \" + $json.body.needs_sales_tax_states + \")\" : \"\" }}\n          </li>\n          <li>Federal Income Tax Prep: {{ $json.body.needs_federal_income_tax_prep ? \"Yes\" : \"No\" }} \n            {{ $json.body.federal_tax_type ? \"(Type: \" + $json.body.federal_tax_type + \")\" : \"\" }}\n          </li>\n          <li>State Income Tax Prep: {{ $json.body.needs_state_income_tax_prep ? \"Yes\" : \"No\" }} \n            {{ $json.body.needs_state_tax_states ? \"(States: \" + $json.needs_state_tax_states + \")\" : \"\" }}\n          </li>\n        </ul>\n      </div>\n\n      <div class=\"field\">\n        <span class=\"label\">Financial Statements Method:</span>\n        <span class=\"value\">{{ $json.body.financial_statements_method || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Income Tax Return Method:</span>\n        <span class=\"value\">{{ $json.body.income_tax_return_method || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Franchise Tax Method:</span>\n        <span class=\"value\">{{ $json.body.franchise_tax_method || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Property Tax Exemptions:</span>\n        <span class=\"value\">{{ $json.body.property_tax_exemptions ? \"Yes\" : \"No\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Reporting Frequency:</span>\n        <span class=\"value\">{{ $json.body.reporting_frequency || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Report Due Date:</span>\n        <span class=\"value\">{{ $json.body.report_due_date || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Sales Tax Deadlines:</span>\n        <span class=\"value\">{{ $json.body.sales_tax_deadlines || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Payroll Processing Period:</span>\n        <span class=\"value\">{{ $json.body.payroll_processing_period || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Other Deadlines:</span>\n        <span class=\"value\">{{ $json.body.other_deadlines || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Additional Details -->\n    <h2>Additional Details</h2>\n    <div class=\"grid\">\n      <div class=\"field full-width\">\n        <span class=\"label\">Additional Requests:</span>\n        <span class=\"value\">{{ $json.body.additional_requests || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Unique GL Accounts:</span>\n        <span class=\"value\">{{ $json.body.unique_gl_accounts || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Payroll Procedures:</span>\n        <span class=\"value\">{{ $json.body.client_payroll_procedures || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Expectations:</span>\n        <span class=\"value\">{{ $json.body.expectations || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Personal & Relationship Info -->\n    <h2>Personal & Relationship Info</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Birthday:</span>\n        <span class=\"value\">{{ $json.body.birthday || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Company Anniversary:</span>\n        <span class=\"value\">{{ $json.body.company_anniversary || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Favorite Dessert:</span>\n        <span class=\"value\">{{ $json.body.favorite_dessert || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Hobbies:</span>\n        <span class=\"value\">{{ $json.body.hobbies || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <p class=\"note\">\n      *This summary is based on the latest client information provided in the MST Client Information Document.\n    </p>\n  </div>\n</body>\n</html>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        448,
        -256
      ],
      "name": "Send Email to MST Team",
      "webhookId": "79ea3ea2-f50a-4caa-bb06-403d9940d63f",
      "credentials": {
        "gmailOAuth2": {
          "id": "BTKh5C4ujrbOxvPI",
          "name": "Rashad.barnett@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "=rashadbarnett@gmail.com, michelle.turner@mstcpatx.com",
        "subject": "=MST Industry Analysis Report – {{ $('Get Customer Data').item.json.body.client_name }} from ",
        "message": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Industry Analysis Summary</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      background: #f3f4f6;\n      font-family: Arial, Helvetica, sans-serif;\n      color: #111827;\n    }\n    .wrapper {\n      width: 100%;\n      padding: 20px 0;\n    }\n    .container {\n      max-width: 900px;\n      margin: 0 auto;\n      background: #ffffff;\n      border-radius: 10px;\n      padding: 24px 30px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.06);\n      border-top: 6px solid #2563eb;\n    }\n    h1, h2, h3 {\n      margin-top: 0;\n      color: #111827;\n    }\n    h1 {\n      font-size: 22px;\n      margin-bottom: 12px;\n    }\n    h2 {\n      font-size: 18px;\n      margin-top: 24px;\n      margin-bottom: 8px;\n      border-left: 4px solid #2563eb;\n      padding-left: 8px;\n    }\n    h3 {\n      font-size: 15px;\n      margin-top: 16px;\n      margin-bottom: 6px;\n      color: #1f2937;\n    }\n    p {\n      font-size: 14px;\n      line-height: 1.6;\n      margin: 6px 0 10px 0;\n    }\n    .pill {\n      display: inline-block;\n      background: #eff6ff;\n      color: #1d4ed8;\n      padding: 4px 10px;\n      border-radius: 999px;\n      font-size: 11px;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      margin-bottom: 10px;\n    }\n    .grid-2 {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 8px 20px;\n    }\n    .field-label {\n      font-size: 12px;\n      font-weight: bold;\n      text-transform: uppercase;\n      letter-spacing: 0.06em;\n      color: #6b7280;\n    }\n    .field-value {\n      font-size: 14px;\n      margin-bottom: 6px;\n    }\n    .box {\n      background: #f9fafb;\n      border-radius: 8px;\n      padding: 10px 12px;\n      border: 1px solid #e5e7eb;\n      margin-top: 6px;\n    }\n    ul {\n      padding-left: 18px;\n      margin: 6px 0 10px 0;\n    }\n    li {\n      font-size: 14px;\n      margin-bottom: 4px;\n    }\n    .small {\n      font-size: 12px;\n      color: #6b7280;\n    }\n    @media (max-width: 640px) {\n      .container {\n        padding: 18px 16px;\n      }\n      .grid-2 {\n        grid-template-columns: 1fr;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wrapper\">\n    <div class=\"container\">\n      <span class=\"pill\">Industry Analysis Report</span>\n      <h1>{{ $json.output.identifiedIndustry || \"Industry Analysis\" }}</h1>\n\n      <!-- Top summary -->\n      <div class=\"grid-2\">\n        <div>\n          <div class=\"field-label\">Sector</div>\n          <div class=\"field-value\">\n            {{ $json.output.industryIdentification.sector || \"N/A\" }}\n          </div>\n        </div>\n        <div>\n          <div class=\"field-label\">Sub-Sector</div>\n          <div class=\"field-value\">\n            {{ $json.output.industryIdentification.subSector || \"N/A\" }}\n          </div>\n        </div>\n        <div>\n          <div class=\"field-label\">Confidence Level</div>\n          <div class=\"field-value\">\n            {{ (Math.round(($json.output.industryIdentification.confidenceLevel || 0) * 100)) + \"%\" }}\n          </div>\n        </div>\n        <div>\n          <div class=\"field-label\">Classification Rationale</div>\n          <div class=\"field-value\">\n            {{ $json.output.industryIdentification.rationale || \"N/A\" }}\n          </div>\n        </div>\n      </div>\n\n      <!-- Industry Deep Dive -->\n      <h2>Industry Deep Dive</h2>\n      <h3>Overview</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.overview || \"N/A\" }}</p>\n      </div>\n\n      <h3>Market Size &amp; Growth</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.marketSizeAndGrowth || \"N/A\" }}</p>\n      </div>\n\n      <h3>Key Segments</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.keySegments || \"N/A\" }}</p>\n      </div>\n\n      <h3>Key Players (Summary)</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.keyPlayers || \"N/A\" }}</p>\n      </div>\n\n      <h3>Growth Drivers</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.growthDrivers || \"N/A\" }}</p>\n      </div>\n\n      <h3>Challenges &amp; Risks</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.challengesAndRisks || \"N/A\" }}</p>\n      </div>\n\n      <h3>Opportunities</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.opportunities || \"N/A\" }}</p>\n      </div>\n\n      <!-- Competitive Landscape -->\n      <h2>Competitive Landscape</h2>\n      <div class=\"box\">\n        <ul>\n          {{\n            ($json.output.competitiveLandscape || []).map(c =>\n              `<li>\n                <strong>${c.name || \"Unnamed Competitor\"}</strong><br/>\n                <span class=\"small\">${c.marketPositioning || \"\"}</span><br/>\n                ${c.description ? c.description + \"<br/>\" : \"\"}\n                ${c.strengths ? \"<strong>Strengths:</strong> \" + c.strengths + \"<br/>\" : \"\"}\n                ${c.weaknesses ? \"<strong>Weaknesses:</strong> \" + c.weaknesses + \"<br/>\" : \"\"}\n                ${c.strategicInitiatives ? \"<strong>Initiatives:</strong> \" + c.strategicInitiatives : \"\"}\n              </li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <!-- Trend Analysis -->\n      <h2>Trend Analysis</h2>\n\n      <h3>Technological Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.technological) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}${t.timeHorizon ? \" <span class='small'>(Time horizon: \" + t.timeHorizon + \")</span>\" : \"\"}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <h3>Regulatory Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.regulatory) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <h3>Economic Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.economic) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <h3>Consumer Behavior Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.consumerBehavior) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <!-- Strategic Insights -->\n      <h2>Strategic Insights &amp; Recommendations</h2>\n      <div class=\"box\">\n        <ul>\n          {{\n            ($json.output.strategicInsights || []).map(s =>\n              `<li>\n                <strong>${s.recommendation}</strong><br/>\n                ${s.rationale ? \"<strong>Rationale:</strong> \" + s.rationale + \"<br/>\" : \"\"}\n                ${s.expectedImpact ? \"<strong>Expected Impact:</strong> \" + s.expectedImpact + \"<br/>\" : \"\"}\n                ${s.priority ? \"<strong>Priority:</strong> \" + s.priority : \"\" }\n                ${s.timeHorizon ? \" <span class='small'>(Time horizon: \" + s.timeHorizon + \")</span>\" : \"\"}\n              </li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <p class=\"small\">\n        This report is based on the latest AI-generated analysis of the customer's industry and market context.\n      </p>\n    </div>\n  </div>\n</body>\n</html>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1552,
        -240
      ],
      "name": "Send AI Outlook Email to MST Team",
      "webhookId": "79ea3ea2-f50a-4caa-bb06-403d9940d63f",
      "credentials": {
        "gmailOAuth2": {
          "id": "BTKh5C4ujrbOxvPI",
          "name": "Rashad.barnett@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "team": "45036767",
        "space": "90113958311",
        "folder": "90117171427",
        "list": "901112199521",
        "filters": {}
      },
      "type": "n8n-nodes-base.clickUp",
      "typeVersion": 1,
      "position": [
        -208,
        224
      ],
      "name": "Get many tasks",
      "credentials": {
        "clickUpApi": {
          "id": "c2MfrYBgHU3wIuVM",
          "name": "MST ClickUp Credentials"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const tasks = $input.all();\nconst isEmpty = (obj) => Object.keys(obj).length === 0;\nconst watchers = tasks.map((task) => { \n  if(task.json.assignees.length === 0) return {};\n  return {\n  \"assignees\": task?.json?.assignees\n  }\n}).filter(x => !isEmpty(x));\nreturn watchers;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -16,
        224
      ],
      "name": "Code in JavaScript"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        176,
        240
      ],
      "name": "Merge"
    },
    {
      "parameters": {
        "toRecipients": "={{ $('Get Customer Data').item.json.body.primary_email }}",
        "subject": "=Thank You for Completing Your Client Information Form",
        "bodyContent": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>MST – Thank You</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      background: #f3f4ff;\n      font-family: Arial, Helvetica, sans-serif;\n      color: #333333;\n    }\n    .email-wrapper {\n      width: 100%;\n      padding: 20px 0;\n    }\n    .email-container {\n      max-width: 640px;\n      margin: 0 auto;\n      background: #ffffff;\n      border-radius: 12px;\n      padding: 24px 28px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n      border-top: 6px solid #4f46e5;\n    }\n    .email-header {\n      text-align: center;\n      margin-bottom: 18px;\n    }\n    .email-header h1 {\n      margin: 0;\n      font-size: 24px;\n      color: #4f46e5;\n    }\n    .email-badge {\n      display: inline-block;\n      margin-top: 8px;\n      padding: 4px 10px;\n      border-radius: 999px;\n      background: #eef2ff;\n      color: #4338ca;\n      font-size: 12px;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      font-weight: 600;\n    }\n    .email-body p {\n      line-height: 1.6;\n      font-size: 15px;\n      margin: 10px 0;\n    }\n    .email-body strong {\n      color: #1d4ed8;\n    }\n    .highlight-box {\n      margin: 18px 0;\n      padding: 14px 16px;\n      border-radius: 10px;\n      background: #ecfeff;\n      border: 1px solid #a5f3fc;\n      font-size: 14px;\n      color: #0f172a;\n    }\n    .cta-button {\n      display: inline-block;\n      margin-top: 18px;\n      padding: 10px 20px;\n      border-radius: 999px;\n      background: #4f46e5;\n      color: #ffffff !important;\n      text-decoration: none;\n      font-size: 14px;\n      font-weight: 600;\n    }\n    .cta-button:hover {\n      background: #4338ca;\n    }\n    .email-footer {\n      text-align: center;\n      margin-top: 22px;\n      font-size: 12px;\n      color: #6b7280;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"email-wrapper\">\n    <div class=\"email-container\">\n      <div class=\"email-header\">\n        <h1>Welcome to MST</h1>\n        <div class=\"email-badge\">New Client</div>\n      </div>\n\n      <div class=\"email-body\">\n        <p>Dear {{ $('Get Customer Data').item.json.body.client_name }},</p>\n\n        <p>\n          Thank you for taking the time to complete the\n          <strong>MST Client Information Document</strong>.\n          We truly appreciate you providing these important details.\n        </p>\n\n        <div class=\"highlight-box\">\n          Our team is now reviewing your information. Once the review is complete,\n          we’ll reach out with any follow-up questions and to walk you through the next steps.\n        </div>\n\n        <p>\n          We’re excited to welcome you to <strong>MST</strong> and look forward to supporting your needs.\n          Our goal is to make things as smooth and stress-free as possible for you.\n        </p>\n\n        <p>\n          If you have any questions in the meantime, please feel free to contact us.\n          We’re here to ensure a seamless experience every step of the way.\n        </p>\n\n        <p>\n          Thank you again for choosing MST — we look forward to working with you.\n        </p>\n\n        <p>\n          Warm regards,<br />\n          <strong>MST Team</strong>\n        </p>\n\n        <!-- Optional CTA (you can remove this if you don’t want a button) -->\n        <!--\n        <a href=\"#\" class=\"cta-button\">Visit Our Website</a>\n        -->\n      </div>\n\n      <div class=\"email-footer\">\n        © {{ new Date().getFullYear() }} MST. All rights reserved.\n      </div>\n    </div>\n  </div>\n</body>\n</html>",
        "additionalFields": {
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        704,
        0
      ],
      "name": "Send Email Confirmation to Customer",
      "webhookId": "789ddd20-355c-4406-9128-8685bb8d70d0",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "RS6O6ncyKxJLSof7",
          "name": "MST Microsoft No-reply"
        }
      }
    },
    {
      "parameters": {
        "toRecipients": "rashadbarnett@gmail.com, michelle.turner@mstcpatx.com, Mstteam@NETORGFT5539831.onmicrosoft.com",
        "subject": "=MST | Client Intake Summary – {{ $json.body.client_name }}",
        "bodyContent": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Client Information Summary</title>\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      background-color: #f5f5f7;\n      margin: 0;\n      padding: 20px;\n      color: #333;\n    }\n    .container {\n      max-width: 900px;\n      margin: 0 auto;\n      background: #ffffff;\n      padding: 20px 30px;\n      border-radius: 8px;\n      box-shadow: 0 2px 6px rgba(0,0,0,0.08);\n    }\n    h1, h2 {\n      margin-top: 0;\n      color: #222;\n    }\n    h1 {\n      font-size: 22px;\n      border-bottom: 2px solid #eee;\n      padding-bottom: 10px;\n      margin-bottom: 20px;\n    }\n    h2 {\n      font-size: 18px;\n      margin-top: 25px;\n      border-left: 4px solid #4a90e2;\n      padding-left: 8px;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 10px 30px;\n    }\n    .field {\n      margin-bottom: 6px;\n    }\n    .label {\n      font-weight: bold;\n      display: inline-block;\n      min-width: 160px;\n    }\n    .value {\n      display: inline-block;\n    }\n    .full-width {\n      grid-column: 1 / -1;\n    }\n    .tag-list {\n      margin: 4px 0 0 0;\n      padding-left: 18px;\n    }\n    .tag-list li {\n      margin-bottom: 4px;\n    }\n    .note {\n      font-size: 12px;\n      color: #777;\n      margin-top: 10px;\n    }\n    @media (max-width: 600px) {\n      .grid {\n        grid-template-columns: 1fr;\n      }\n      .label {\n        min-width: 120px;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <h1>Client Information Summary</h1>\n\n    <!-- Client Overview -->\n    <h2>Client Overview</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Client Name:</span>\n        <span class=\"value\">{{ $json.body.client_name || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Client Short Name:</span>\n        <span class=\"value\">{{ $json.body.client_short_name || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Address:</span>\n        <span class=\"value\">{{ $json.body.client_address || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Industry:</span>\n        <span class=\"value\">{{ $json.body.industry || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Softwares Used:</span>\n        <span class=\"value\">{{ $json.body.softwares_used || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Business Operations Summary:</span>\n        <span class=\"value\">{{ $json.body.business_ops_summary || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Contacts -->\n    <h2>Primary Contact</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Name &amp; Title:</span>\n        <span class=\"value\">{{ $json.body.primary_name_title || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Phone:</span>\n        <span class=\"value\">{{ $json.body.primary_phone || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Email:</span>\n        <span class=\"value\">{{ $json.body.primary_email || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Contact For:</span>\n        <span class=\"value\">\n          {{ $json.body.primary_contact_for || \"N/A\" }}\n          {{ $json.body.primary_contact_other ? \" (\" + $json.primary_contact_other + \")\" : \"\" }}\n        </span>\n      </div>\n    </div>\n\n    <h2>Other Contact</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Name:</span>\n        <span class=\"value\">{{ $json.body.other_name || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Phone:</span>\n        <span class=\"value\">{{ $json.body.other_phone || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Email:</span>\n        <span class=\"value\">{{ $json.body.other_email || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Contact For:</span>\n        <span class=\"value\">{{ $json.body.other_contact_for || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Associated Entities -->\n    <h2>Associated Entities</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Entity 1:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_1 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Entity 2:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_2 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Entity 3:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_3 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Entity 4:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_4 || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Entity 5:</span>\n        <span class=\"value\">{{ $json.body.associated_entity_5 || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Services & Needs -->\n    <h2>Services &amp; Needs</h2>\n    <div class=\"grid\">\n      <div class=\"field full-width\">\n        <span class=\"label\">Client Services (Notes):</span>\n        <span class=\"value\">\n          {{\n            [\n              $json.body.client_services_1,\n              $json.body.client_services_2,\n              $json.body.client_services_3,\n              $json.body.client_services_4,\n              $json.body.client_services_5,\n              $json.body.client_services_6\n            ].filter(s => s).join(\"; \")\n            || \"N/A\"\n          }}\n        </span>\n      </div>\n\n      <div class=\"field full-width\">\n        <span class=\"label\">Service Needs:</span>\n        <ul class=\"tag-list\">\n          <li>Accounting: {{ $json.body.needs_accounting ? \"Yes\" : \"No\" }}</li>\n          <li>Payroll: {{ $json.body.needs_payroll ? \"Yes\" : \"No\" }} \n            {{ $json.body.needs_payroll_states ? \"(States: \" + $json.needs_payroll_states + \")\" : \"\" }}\n          </li>\n          <li>Sales Tax: {{ $json.body.needs_sales_tax ? \"Yes\" : \"No\" }} \n            {{ $json.body.needs_sales_tax_states ? \"(States: \" + $json.body.needs_sales_tax_states + \")\" : \"\" }}\n          </li>\n          <li>Federal Income Tax Prep: {{ $json.body.needs_federal_income_tax_prep ? \"Yes\" : \"No\" }} \n            {{ $json.body.federal_tax_type ? \"(Type: \" + $json.body.federal_tax_type + \")\" : \"\" }}\n          </li>\n          <li>State Income Tax Prep: {{ $json.body.needs_state_income_tax_prep ? \"Yes\" : \"No\" }} \n            {{ $json.body.needs_state_tax_states ? \"(States: \" + $json.needs_state_tax_states + \")\" : \"\" }}\n          </li>\n        </ul>\n      </div>\n\n      <div class=\"field\">\n        <span class=\"label\">Financial Statements Method:</span>\n        <span class=\"value\">{{ $json.body.financial_statements_method || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Income Tax Return Method:</span>\n        <span class=\"value\">{{ $json.body.income_tax_return_method || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Franchise Tax Method:</span>\n        <span class=\"value\">{{ $json.body.franchise_tax_method || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Property Tax Exemptions:</span>\n        <span class=\"value\">{{ $json.body.property_tax_exemptions ? \"Yes\" : \"No\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Reporting Frequency:</span>\n        <span class=\"value\">{{ $json.body.reporting_frequency || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Report Due Date:</span>\n        <span class=\"value\">{{ $json.body.report_due_date || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Sales Tax Deadlines:</span>\n        <span class=\"value\">{{ $json.body.sales_tax_deadlines || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Payroll Processing Period:</span>\n        <span class=\"value\">{{ $json.body.payroll_processing_period || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Other Deadlines:</span>\n        <span class=\"value\">{{ $json.body.other_deadlines || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Additional Details -->\n    <h2>Additional Details</h2>\n    <div class=\"grid\">\n      <div class=\"field full-width\">\n        <span class=\"label\">Additional Requests:</span>\n        <span class=\"value\">{{ $json.body.additional_requests || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Unique GL Accounts:</span>\n        <span class=\"value\">{{ $json.body.unique_gl_accounts || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Payroll Procedures:</span>\n        <span class=\"value\">{{ $json.body.client_payroll_procedures || \"N/A\" }}</span>\n      </div>\n      <div class=\"field full-width\">\n        <span class=\"label\">Expectations:</span>\n        <span class=\"value\">{{ $json.body.expectations || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <!-- Personal & Relationship Info -->\n    <h2>Personal & Relationship Info</h2>\n    <div class=\"grid\">\n      <div class=\"field\">\n        <span class=\"label\">Birthday:</span>\n        <span class=\"value\">{{ $json.body.birthday || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Company Anniversary:</span>\n        <span class=\"value\">{{ $json.body.company_anniversary || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Favorite Dessert:</span>\n        <span class=\"value\">{{ $json.body.favorite_dessert || \"N/A\" }}</span>\n      </div>\n      <div class=\"field\">\n        <span class=\"label\">Hobbies:</span>\n        <span class=\"value\">{{ $json.body.hobbies || \"N/A\" }}</span>\n      </div>\n    </div>\n\n    <p class=\"note\">\n      *This summary is based on the latest client information provided in the MST Client Information Document.\n    </p>\n  </div>\n</body>\n</html>",
        "additionalFields": {
          "from": "MST Confirmation",
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        464,
        0
      ],
      "name": "Send Backup Email to MST Team",
      "webhookId": "789ddd20-355c-4406-9128-8685bb8d70d0",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "RS6O6ncyKxJLSof7",
          "name": "MST Microsoft No-reply"
        }
      }
    },
    {
      "parameters": {
        "toRecipients": "rashadbarnett@gmail.com, michelle.turner@mstcpatx.com, Mstteam@NETORGFT5539831.onmicrosoft.com",
        "subject": "=MST Industry Analysis Report – {{ $('Get Customer Data').item.json.body.client_name }}",
        "bodyContent": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>Industry Analysis Summary</title>\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      background: #f3f4f6;\n      font-family: Arial, Helvetica, sans-serif;\n      color: #111827;\n    }\n    .wrapper {\n      width: 100%;\n      padding: 20px 0;\n    }\n    .container {\n      max-width: 900px;\n      margin: 0 auto;\n      background: #ffffff;\n      border-radius: 10px;\n      padding: 24px 30px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.06);\n      border-top: 6px solid #2563eb;\n    }\n    h1, h2, h3 {\n      margin-top: 0;\n      color: #111827;\n    }\n    h1 {\n      font-size: 22px;\n      margin-bottom: 12px;\n    }\n    h2 {\n      font-size: 18px;\n      margin-top: 24px;\n      margin-bottom: 8px;\n      border-left: 4px solid #2563eb;\n      padding-left: 8px;\n    }\n    h3 {\n      font-size: 15px;\n      margin-top: 16px;\n      margin-bottom: 6px;\n      color: #1f2937;\n    }\n    p {\n      font-size: 14px;\n      line-height: 1.6;\n      margin: 6px 0 10px 0;\n    }\n    .pill {\n      display: inline-block;\n      background: #eff6ff;\n      color: #1d4ed8;\n      padding: 4px 10px;\n      border-radius: 999px;\n      font-size: 11px;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      margin-bottom: 10px;\n    }\n    .grid-2 {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 8px 20px;\n    }\n    .field-label {\n      font-size: 12px;\n      font-weight: bold;\n      text-transform: uppercase;\n      letter-spacing: 0.06em;\n      color: #6b7280;\n    }\n    .field-value {\n      font-size: 14px;\n      margin-bottom: 6px;\n    }\n    .box {\n      background: #f9fafb;\n      border-radius: 8px;\n      padding: 10px 12px;\n      border: 1px solid #e5e7eb;\n      margin-top: 6px;\n    }\n    ul {\n      padding-left: 18px;\n      margin: 6px 0 10px 0;\n    }\n    li {\n      font-size: 14px;\n      margin-bottom: 4px;\n    }\n    .small {\n      font-size: 12px;\n      color: #6b7280;\n    }\n    @media (max-width: 640px) {\n      .container {\n        padding: 18px 16px;\n      }\n      .grid-2 {\n        grid-template-columns: 1fr;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wrapper\">\n    <div class=\"container\">\n      <span class=\"pill\">Industry Analysis Report</span>\n      <h1>{{ $json.output.identifiedIndustry || \"Industry Analysis\" }}</h1>\n\n      <!-- Top summary -->\n      <div class=\"grid-2\">\n        <div>\n          <div class=\"field-label\">Sector</div>\n          <div class=\"field-value\">\n            {{ $json.output.industryIdentification.sector || \"N/A\" }}\n          </div>\n        </div>\n        <div>\n          <div class=\"field-label\">Sub-Sector</div>\n          <div class=\"field-value\">\n            {{ $json.output.industryIdentification.subSector || \"N/A\" }}\n          </div>\n        </div>\n        <div>\n          <div class=\"field-label\">Confidence Level</div>\n          <div class=\"field-value\">\n            {{ (Math.round(($json.output.industryIdentification.confidenceLevel || 0) * 100)) + \"%\" }}\n          </div>\n        </div>\n        <div>\n          <div class=\"field-label\">Classification Rationale</div>\n          <div class=\"field-value\">\n            {{ $json.output.industryIdentification.rationale || \"N/A\" }}\n          </div>\n        </div>\n      </div>\n\n      <!-- Industry Deep Dive -->\n      <h2>Industry Deep Dive</h2>\n      <h3>Overview</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.overview || \"N/A\" }}</p>\n      </div>\n\n      <h3>Market Size &amp; Growth</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.marketSizeAndGrowth || \"N/A\" }}</p>\n      </div>\n\n      <h3>Key Segments</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.keySegments || \"N/A\" }}</p>\n      </div>\n\n      <h3>Key Players (Summary)</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.keyPlayers || \"N/A\" }}</p>\n      </div>\n\n      <h3>Growth Drivers</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.growthDrivers || \"N/A\" }}</p>\n      </div>\n\n      <h3>Challenges &amp; Risks</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.challengesAndRisks || \"N/A\" }}</p>\n      </div>\n\n      <h3>Opportunities</h3>\n      <div class=\"box\">\n        <p>{{ $json.output.industryDeepDive.opportunities || \"N/A\" }}</p>\n      </div>\n\n      <!-- Competitive Landscape -->\n      <h2>Competitive Landscape</h2>\n      <div class=\"box\">\n        <ul>\n          {{\n            ($json.output.competitiveLandscape || []).map(c =>\n              `<li>\n                <strong>${c.name || \"Unnamed Competitor\"}</strong><br/>\n                <span class=\"small\">${c.marketPositioning || \"\"}</span><br/>\n                ${c.description ? c.description + \"<br/>\" : \"\"}\n                ${c.strengths ? \"<strong>Strengths:</strong> \" + c.strengths + \"<br/>\" : \"\"}\n                ${c.weaknesses ? \"<strong>Weaknesses:</strong> \" + c.weaknesses + \"<br/>\" : \"\"}\n                ${c.strategicInitiatives ? \"<strong>Initiatives:</strong> \" + c.strategicInitiatives : \"\"}\n              </li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <!-- Trend Analysis -->\n      <h2>Trend Analysis</h2>\n\n      <h3>Technological Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.technological) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}${t.timeHorizon ? \" <span class='small'>(Time horizon: \" + t.timeHorizon + \")</span>\" : \"\"}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <h3>Regulatory Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.regulatory) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <h3>Economic Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.economic) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <h3>Consumer Behavior Trends</h3>\n      <div class=\"box\">\n        <ul>\n          {{\n            (($json.output.trendAnalysis && $json.output.trendAnalysis.consumerBehavior) || []).map(t =>\n              `<li><strong>${t.trend}</strong><br/>${t.impact}</li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <!-- Strategic Insights -->\n      <h2>Strategic Insights &amp; Recommendations</h2>\n      <div class=\"box\">\n        <ul>\n          {{\n            ($json.output.strategicInsights || []).map(s =>\n              `<li>\n                <strong>${s.recommendation}</strong><br/>\n                ${s.rationale ? \"<strong>Rationale:</strong> \" + s.rationale + \"<br/>\" : \"\"}\n                ${s.expectedImpact ? \"<strong>Expected Impact:</strong> \" + s.expectedImpact + \"<br/>\" : \"\"}\n                ${s.priority ? \"<strong>Priority:</strong> \" + s.priority : \"\" }\n                ${s.timeHorizon ? \" <span class='small'>(Time horizon: \" + s.timeHorizon + \")</span>\" : \"\"}\n              </li>`\n            ).join(\"\")\n          }}\n        </ul>\n      </div>\n\n      <p class=\"small\">\n        This report is based on the latest AI-generated analysis of the customer's industry and market context.\n      </p>\n    </div>\n  </div>\n</body>\n</html>",
        "additionalFields": {
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        1568,
        0
      ],
      "name": "Send Analysis Email to MST Team",
      "webhookId": "789ddd20-355c-4406-9128-8685bb8d70d0",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "RS6O6ncyKxJLSof7",
          "name": "MST Microsoft No-reply"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1232,
        288
      ],
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "51hIFZmWsjzQuJAg",
          "name": "Rashad's OpenAi Account"
        }
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Get Customer Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Customer Data": {
      "main": [
        [
          {
            "node": "Send Backup Email to MST Team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send Analysis Email to MST Team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Send Email to Customer": {
      "main": [
        []
      ]
    },
    "Send Email to MST Team": {
      "main": [
        [
          {
            "node": "Send Email to Customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many tasks": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        []
      ]
    },
    "Send Backup Email to MST Team": {
      "main": [
        [
          {
            "node": "Send Email Confirmation to Customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email Confirmation to Customer": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    }
  },
  "settings": {},
  "tags": [],
  "active": true
}